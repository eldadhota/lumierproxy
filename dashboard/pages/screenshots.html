<!DOCTYPE html><html><head><title>Lumier Dynamics - Remote Screenshots</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>` + baseStyles + `.screenshot-controls{background:#1a1a1a;padding:20px;border-radius:12px;border:1px solid #2a2a2a;margin-bottom:20px;display:flex;align-items:center;gap:20px;flex-wrap:wrap}.device-selector{display:flex;align-items:center;gap:10px;flex:1}.device-selector label{font-weight:600;color:#888}.device-selector select{padding:10px 15px;border:1px solid #2a2a2a;border-radius:8px;font-size:1em;background:#121212;color:#e0e0e0;min-width:250px}.capture-btn{background:#4a9eff;color:white;border:none;padding:12px 24px;border-radius:8px;font-size:1em;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.2s}.capture-btn:hover{background:#3a8eef}.capture-btn:disabled{background:#666;cursor:not-allowed}.auto-refresh-group{display:flex;align-items:center;gap:10px;color:#888}.auto-refresh-group select{padding:8px 12px;border:1px solid #2a2a2a;border-radius:6px;background:#121212;color:#e0e0e0;font-size:0.9em}.screenshot-status{margin-left:auto;color:#888;font-size:0.9em}.latest-container{background:#1a1a1a;border-radius:12px;border:1px solid #2a2a2a;margin-bottom:20px;overflow:hidden}.latest-header{padding:15px 20px;background:#252525;display:flex;justify-content:space-between;align-items:center}.latest-header h3{margin:0;color:#e0e0e0;font-size:1.1em}.latest-meta{color:#888;font-size:0.85em}.latest-image-container{padding:20px;text-align:center;background:#0a0a0a;min-height:200px;display:flex;align-items:center;justify-content:center}.latest-image{max-width:100%;max-height:600px;border-radius:8px;cursor:pointer;transition:transform 0.2s}.latest-image:hover{transform:scale(1.02)}.no-screenshot{color:#666;text-align:center;padding:60px 20px}.no-screenshot-icon{font-size:4em;margin-bottom:20px}.history-container{background:#1a1a1a;border-radius:12px;border:1px solid #2a2a2a}.history-header{padding:15px 20px;background:#252525;border-radius:12px 12px 0 0;display:flex;justify-content:space-between;align-items:center}.history-header h3{margin:0;color:#e0e0e0;font-size:1.1em}.history-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px;padding:20px}.history-item{background:#121212;border-radius:8px;overflow:hidden;border:1px solid #2a2a2a;transition:all 0.2s;position:relative}.history-item:hover{border-color:#4a9eff;transform:translateY(-2px)}.history-thumb{width:100%;aspect-ratio:16/9;object-fit:cover;cursor:pointer}.history-info{padding:10px}.history-device{font-size:0.9em;color:#4a9eff;font-weight:500}.history-user{font-size:0.75em;color:#888;margin-top:2px}.history-time{font-size:0.8em;color:#888;margin-top:5px}.history-size{font-size:0.75em;color:#666;margin-top:3px}.history-delete{position:absolute;top:8px;right:8px;background:rgba(244,67,54,0.9);color:white;border:none;width:28px;height:28px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:0.9em;opacity:0;transition:opacity 0.2s}.history-item:hover .history-delete{opacity:1}.history-delete:hover{background:#f44336}.fullscreen-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.95);z-index:1000;display:none;align-items:center;justify-content:center;cursor:pointer;flex-direction:column}.fullscreen-overlay.active{display:flex}.fullscreen-image{max-width:95%;max-height:85%;object-fit:contain}.fullscreen-info{color:#888;margin-top:15px;font-size:0.9em}.empty-history{text-align:center;padding:40px;color:#666;grid-column:1/-1}.pending-indicator{display:inline-block;width:8px;height:8px;background:#ff9800;border-radius:50%;margin-left:8px;animation:pulse 1s infinite}</style></head><body>` + navHTML + `<div class="main-content"><div class="page-header"><h1>üì∏ Remote Screenshots</h1><p>Capture screenshots from client devices running the Lumier launcher</p></div><div class="screenshot-controls"><div class="device-selector"><label>Device:</label><select id="deviceSelect" onchange="filterScreenshots()"><option value="">All Devices</option></select></div><button class="capture-btn" id="captureBtn" onclick="requestScreenshot()" disabled><span>üì∑</span><span>Request Screenshot</span></button><div class="auto-refresh-group"><label>Auto-refresh:</label><select id="autoInterval" onchange="updateAutoRefresh()"><option value="0">Off</option><option value="5" selected>5s</option><option value="10">10s</option><option value="30">30s</option></select></div><div class="screenshot-status" id="statusText"></div></div><div class="latest-container"><div class="latest-header"><h3>üì∫ Latest Screenshot</h3><div class="latest-meta" id="latestMeta"></div></div><div class="latest-image-container" id="latestContainer"><div class="no-screenshot"><div class="no-screenshot-icon">üì∑</div><h2>No Screenshots Yet</h2><p>Select a device and click "Request Screenshot" to capture their screen.<br>The device must be running the Lumier launcher with an active browser session.</p></div></div></div><div class="history-container"><div class="history-header"><h3>üìÅ Screenshot History</h3><span id="historyCount" style="color:#888;font-size:0.9em">0 screenshots</span></div><div class="history-grid" id="historyGrid"><div class="empty-history">No screenshots available</div></div></div></div><div class="fullscreen-overlay" id="fullscreenOverlay" onclick="closeFullscreen()"><img id="fullscreenImage" class="fullscreen-image"><div class="fullscreen-info" id="fullscreenInfo"></div></div><script>` + baseJS + `document.getElementById('nav-screenshots').classList.add('active');let autoInterval=null;let screenshots=[];let devices=[];let selectedDeviceID='';function loadDevices(){fetch('/api/screenshot/active-devices').then(r=>r.json()).then(data=>{devices=data.devices||[];const select=document.getElementById('deviceSelect');const current=select.value;if(devices.length===0){select.innerHTML='<option value="">No active devices</option>';}else{select.innerHTML='<option value="">Select a device...</option>';devices.forEach(d=>{select.innerHTML+='<option value="'+d.id+'">'+escapeHtml(d.name)+' ('+escapeHtml(d.proxy_name||'Default')+')</option>';});}if(current)select.value=current;updateCaptureButton();}).catch(()=>{});}function updateCaptureButton(){const btn=document.getElementById('captureBtn');const deviceID=document.getElementById('deviceSelect').value;btn.disabled=!deviceID;if(deviceID){btn.innerHTML='<span>üì∑</span><span>Request Screenshot</span>';}else{btn.innerHTML='<span>üì∑</span><span>Select a Device</span>';}}function loadScreenshots(){const deviceID=document.getElementById('deviceSelect').value;selectedDeviceID=deviceID;fetch('/api/screenshot/list'+(deviceID?'?device_id='+deviceID:'')).then(r=>r.json()).then(data=>{screenshots=data.screenshots||[];document.getElementById('historyCount').textContent=screenshots.length+' screenshot'+(screenshots.length!==1?'s':'');renderLatest();renderHistory();}).catch(e=>{document.getElementById('statusText').textContent='Error loading screenshots';});}function filterScreenshots(){updateCaptureButton();loadScreenshots();}function renderLatest(){const container=document.getElementById('latestContainer');const meta=document.getElementById('latestMeta');if(!screenshots.length){container.innerHTML='<div class="no-screenshot"><div class="no-screenshot-icon">üì∑</div><h2>No Screenshots Yet</h2><p>Select a device and click "Request Screenshot" to capture their screen.<br>The device must be running the Lumier launcher with an active browser session.</p></div>';meta.textContent='';return;}const latest=screenshots[0];const time=new Date(latest.capture_time).toLocaleString();const size=formatBytes(latest.size_bytes);const device=latest.device_name||latest.device_id||'Unknown';meta.innerHTML='<strong>'+escapeHtml(device)+'</strong> | '+time+' | '+(latest.width||'?')+'x'+(latest.height||'?')+' | '+size;if(latest.username)meta.innerHTML+=' | by '+escapeHtml(latest.username);container.innerHTML='<img src="/api/screenshot/image?id='+latest.id+'&t='+Date.now()+'" class="latest-image" onclick="openFullscreen(this.src,\''+escapeHtml(device)+'\',\''+time+'\')" alt="Latest screenshot">';}function renderHistory(){const grid=document.getElementById('historyGrid');if(!screenshots.length){grid.innerHTML='<div class="empty-history">No screenshots available</div>';return;}grid.innerHTML=screenshots.map(s=>{const time=new Date(s.capture_time).toLocaleTimeString();const date=new Date(s.capture_time).toLocaleDateString();const device=s.device_name||s.device_id||'Unknown';return'<div class="history-item"><img src="/api/screenshot/image?id='+s.id+'" class="history-thumb" onclick="openFullscreen(this.src,\''+escapeHtml(device)+'\',\''+date+' '+time+'\')" alt="Screenshot"><button class="history-delete" onclick="deleteScreenshot(event,\''+s.id+'\')" title="Delete">üóëÔ∏è</button><div class="history-info"><div class="history-device">'+escapeHtml(device)+'</div>'+(s.username?'<div class="history-user">by '+escapeHtml(s.username)+'</div>':'')+'<div class="history-time">'+date+' '+time+'</div><div class="history-size">'+(s.width||'?')+'x'+(s.height||'?')+' - '+formatBytes(s.size_bytes)+'</div></div></div>';}).join('');}function requestScreenshot(){const deviceID=document.getElementById('deviceSelect').value;if(!deviceID)return;const btn=document.getElementById('captureBtn');const status=document.getElementById('statusText');btn.disabled=true;btn.innerHTML='<span>‚è≥</span><span>Requesting...</span>';status.innerHTML='Waiting for device to capture...<span class="pending-indicator"></span>';fetch('/api/screenshot/request?device_id='+deviceID,{method:'POST'}).then(r=>r.json()).then(data=>{if(data.success){setTimeout(()=>{loadScreenshots();btn.disabled=false;btn.innerHTML='<span>üì∑</span><span>Request Screenshot</span>';status.textContent='Screenshot requested - waiting for upload';},2000);}else{btn.disabled=false;btn.innerHTML='<span>üì∑</span><span>Request Screenshot</span>';status.textContent='Error: '+(data.error||'Unknown error');}}).catch(e=>{btn.disabled=false;btn.innerHTML='<span>üì∑</span><span>Request Screenshot</span>';status.textContent='Error: '+e.message;});}function deleteScreenshot(event,id){event.stopPropagation();if(!confirm('Delete this screenshot?'))return;fetch('/api/screenshot/delete?id='+id,{method:'POST'}).then(r=>r.json()).then(data=>{if(data.success){loadScreenshots();}}).catch(()=>{});}function openFullscreen(src,device,time){document.getElementById('fullscreenImage').src=src;document.getElementById('fullscreenInfo').textContent=device+' - '+time;document.getElementById('fullscreenOverlay').classList.add('active');}function closeFullscreen(){document.getElementById('fullscreenOverlay').classList.remove('active');}function updateAutoRefresh(){const interval=parseInt(document.getElementById('autoInterval').value);if(autoInterval){clearInterval(autoInterval);autoInterval=null;}if(interval>0){autoInterval=setInterval(loadScreenshots,interval*1000);}}function escapeHtml(t){if(!t)return'';const d=document.createElement('div');d.textContent=t;return d.innerHTML;}document.addEventListener('keydown',e=>{if(e.key==='Escape')closeFullscreen();});loadDevices();loadScreenshots();updateAutoRefresh();setInterval(loadDevices,30000);</script></body></html>
