<!DOCTYPE html><html><head><title>Lumier Dynamics - Settings</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>` + baseStyles + `.settings-section{background:#1a1a1a;border-radius:12px;padding:25px;border:1px solid #2a2a2a;margin-bottom:20px}.settings-section h2{margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid #2a2a2a}.form-group{margin-bottom:20px}.form-group label{display:block;font-weight:600;color:#e0e0e0;margin-bottom:8px}.form-group input{width:100%;max-width:400px;padding:12px;border:2px solid #2a2a2a;border-radius:8px;font-size:1em;background:#121212;color:#e0e0e0}.form-group input:focus{outline:none;border-color:#4a9eff}.form-group small{display:block;color:#666;margin-top:5px;font-size:0.85em}.success-msg{background:#1a3d1a;color:#4caf50;padding:12px;border-radius:8px;border:1px solid #4caf50;margin-bottom:20px;display:none}.success-msg.show{display:block}</style></head><body>` + navHTML + `<div class="main-content"><div class="page-header"><h1>‚öôÔ∏è Settings</h1><p>Configure your Lumier Dynamics system</p></div><div class="settings-section"><h2>üîê Change Password</h2><div class="success-msg" id="pwSuccess">Password changed successfully!</div><form onsubmit="return changePassword(event)"><div class="form-group"><label>Current Password</label><input type="password" id="oldPassword" required></div><div class="form-group"><label>New Password</label><input type="password" id="newPassword" required><small>Choose a strong password with at least 8 characters</small></div><div class="form-group"><label>Confirm New Password</label><input type="password" id="confirmPassword" required></div><button type="submit" class="btn btn-primary">Change Password</button></form></div><div class="settings-section"><h2>üì± Device Groups</h2><p style="margin-bottom:15px;color:#666">Manage device groups for better organization</p><div id="groupsList" style="margin-bottom:15px"></div><div style="display:flex;gap:10px"><input type="text" id="newGroupName" placeholder="New group name..." style="padding:10px;border:2px solid #e0e0e0;border-radius:8px;flex:1;max-width:300px"><button class="btn btn-primary" onclick="addGroup()">Add Group</button></div></div><div class="settings-section"><h2>üåê Proxy Management</h2><p style="margin-bottom:15px;color:#666">Manage and organize upstream SOCKS5 proxies</p><table id="proxyTable" style="width:100%;border-collapse:collapse;margin-bottom:20px"><thead><tr style="background:#1e1e1e"><th style="padding:12px;text-align:left;border-bottom:2px solid #e0e0e0">#</th><th style="padding:12px;text-align:left;border-bottom:2px solid #e0e0e0">Name</th><th style="padding:12px;text-align:left;border-bottom:2px solid #e0e0e0">IP Address</th><th style="padding:12px;text-align:center;border-bottom:2px solid #e0e0e0">Order</th><th style="padding:12px;text-align:center;border-bottom:2px solid #e0e0e0">Actions</th></tr></thead><tbody id="proxyTableBody"></tbody></table><div style="display:flex;gap:10px;flex-wrap:wrap"><input type="text" id="newProxyString" placeholder="host:port:username:password" style="padding:10px;border:2px solid #e0e0e0;border-radius:8px;flex:1;min-width:300px;max-width:500px"><button class="btn btn-primary" onclick="addProxy()">Add Proxy</button></div><p style="margin-top:10px;color:#888;font-size:0.85em">Format: host:port:username:password (e.g., proxy.example.com:1080:user:pass)</p><div style="margin-top:20px;padding-top:20px;border-top:1px solid #eee"><h3 style="margin-bottom:15px;font-size:1.1em">üì• Bulk Import Proxies</h3><p style="margin-bottom:10px;color:#666;font-size:0.9em">Paste multiple proxies (one per line) in format: host:port:username:password</p><textarea id="bulkProxies" placeholder="brd.superproxy.io:22228:brd-customer-xxx-ip-1.2.3.4:password&#10;brd.superproxy.io:22228:brd-customer-xxx-ip-5.6.7.8:password&#10;..." style="width:100%;height:150px;padding:10px;border:2px solid #e0e0e0;border-radius:8px;font-family:monospace;font-size:0.9em"></textarea><div style="margin-top:10px;display:flex;gap:10px;align-items:center"><button class="btn btn-primary" onclick="bulkImportProxies()">Import Proxies</button><span id="bulkImportResult" style="color:#666;font-size:0.9em"></span></div></div></div><div class="settings-section"><h2>üë§ Supervisor Management</h2><p style="margin-bottom:15px;color:#666">Manage supervisor accounts for the Android app (used for Change Proxy authentication)</p><div style="margin-bottom:20px"><h3 style="font-size:1em;margin-bottom:10px">üîê Admin Password (for Register Device)</h3><div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap"><input type="password" id="adminPassword" placeholder="Admin password" style="padding:10px;border:2px solid #e0e0e0;border-radius:8px;width:250px"><button class="btn btn-primary" onclick="updateAdminPassword()">Update Admin Password</button><button class="btn btn-secondary" onclick="togglePasswordVisibility('adminPassword')" style="padding:10px">üëÅÔ∏è</button></div></div><div style="margin-bottom:15px"><h3 style="font-size:1em;margin-bottom:10px">üë• Supervisors (for Change Proxy)</h3><div id="supervisorsList" style="margin-bottom:15px"></div><div style="display:flex;gap:10px;flex-wrap:wrap"><input type="text" id="newSupervisorName" placeholder="Name" style="padding:10px;border:2px solid #e0e0e0;border-radius:8px;width:150px"><input type="password" id="newSupervisorPassword" placeholder="Password" style="padding:10px;border:2px solid #e0e0e0;border-radius:8px;width:200px"><button class="btn btn-primary" onclick="addSupervisor()">Add Supervisor</button></div></div></div><div class="settings-section"><h2>‚è±Ô∏è Session Settings</h2><p style="margin-bottom:15px;color:#666">Configure session timeout for device connections. Devices must re-confirm their connection after the timeout expires.</p><div style="display:flex;gap:15px;align-items:center;flex-wrap:wrap;margin-bottom:15px"><div style="display:flex;align-items:center;gap:10px"><label style="font-weight:600;color:#e0e0e0">Session Timeout:</label><input type="number" id="sessionTimeout" min="1" max="48" value="2" style="padding:10px;border:2px solid #e0e0e0;border-radius:8px;width:80px;text-align:center;font-weight:600"><span style="color:#666">hours</span></div><button class="btn btn-primary" onclick="saveSessionSettings()">Save Settings</button></div><p style="color:#888;font-size:0.85em">Range: 1-48 hours. Default: 2 hours. Devices will need to confirm their proxy connection again after this time.</p></div><div class="settings-section"><h2>‚ÑπÔ∏è System Information</h2><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px"><div style="background:#121212;padding:15px;border-radius:8px"><strong>Version:</strong> 3.0.0</div><div style="background:#121212;padding:15px;border-radius:8px"><strong>Server IP:</strong> <span id="sysServerIP">...</span></div><div style="background:#121212;padding:15px;border-radius:8px"><strong>Proxy Port:</strong> 8888</div><div style="background:#121212;padding:15px;border-radius:8px"><strong>Dashboard Port:</strong> 8080</div></div></div></div><script>` + baseJS + `document.getElementById('nav-settings').classList.add('active');fetch('/api/server-ip').then(r=>r.text()).then(ip=>document.getElementById('sysServerIP').textContent=ip);function loadGroups(){fetch('/api/groups').then(r=>r.json()).then(groups=>{document.getElementById('groupsList').innerHTML=groups.map(g=>{const isDefault=g==='Default';return'<span style="display:inline-flex;align-items:center;gap:8px;background:#e3f2fd;color:#1976d2;padding:8px 15px;border-radius:20px;margin:5px;font-weight:500">'+g+(isDefault?'':' <button onclick="deleteGroup(\''+g+'\')" style="background:#ef5350;color:white;border:none;border-radius:50%;width:20px;height:20px;cursor:pointer;font-size:14px;line-height:1;display:flex;align-items:center;justify-content:center" title="Delete group">&times;</button>')+'</span>';}).join('');});}loadGroups();function deleteGroup(name){if(!confirm('Delete group "'+name+'"? Devices in this group will be moved to Default.')){return;}fetch('/api/delete-group',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({group_name:name})}).then(r=>{if(r.ok)return r.json();throw new Error('Failed to delete');}).then(d=>{if(d.ok){showToast('Group deleted','success');loadGroups();}}).catch(()=>showToast('Failed to delete group','error'));}function addGroup(){const name=document.getElementById('newGroupName').value.trim();if(!name){showToast('Please enter a group name','error');return;}fetch('/api/add-group',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({group_name:name})}).then(r=>r.json()).then(d=>{if(d.ok){showToast(d.added?'Group added':'Group already exists',d.added?'success':'');document.getElementById('newGroupName').value='';loadGroups();}});}function changePassword(e){e.preventDefault();const oldPw=document.getElementById('oldPassword').value;const newPw=document.getElementById('newPassword').value;const confirmPw=document.getElementById('confirmPassword').value;if(newPw!==confirmPw){showToast('Passwords do not match','error');return false;}if(newPw.length<6){showToast('Password must be at least 6 characters','error');return false;}fetch('/api/change-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({old_password:oldPw,new_password:newPw})}).then(r=>{if(r.ok){document.getElementById('pwSuccess').classList.add('show');document.getElementById('oldPassword').value='';document.getElementById('newPassword').value='';document.getElementById('confirmPassword').value='';setTimeout(()=>document.getElementById('pwSuccess').classList.remove('show'),3000);}else{showToast('Current password is incorrect','error');}});return false;}let allProxies=[];function loadProxies(){fetch('/api/proxies').then(r=>r.json()).then(proxies=>{allProxies=proxies;const tbody=document.getElementById('proxyTableBody');if(!proxies.length){tbody.innerHTML='<tr><td colspan="5" style="padding:20px;text-align:center;color:#666">No proxies configured. Add your first proxy below.</td></tr>';return;}tbody.innerHTML=proxies.map((p,i)=>{let ip=p.user&&p.user.includes('ip-')?p.user.split('ip-')[1]:p.host;const name=p.custom_name||'SG'+String(i+1).padStart(2,'0');return'<tr style="border-bottom:1px solid #2a2a2a"><td style="padding:12px;font-weight:600;color:#4a9eff">'+(i+1)+'</td><td style="padding:12px"><input type="text" value="'+escapeAttr(name)+'" style="padding:8px 12px;border:2px solid #e0e0e0;border-radius:6px;font-weight:600;width:100px" onchange="updateProxyName('+i+',this.value)" placeholder="SG'+String(i+1).padStart(2,'0')+'"></td><td style="padding:12px;font-family:monospace;color:#e0e0e0">'+ip+'</td><td style="padding:12px;text-align:center"><button onclick="moveProxy('+i+',-1)" style="background:#e3f2fd;border:none;border-radius:4px;padding:6px 10px;cursor:pointer;margin-right:5px" '+(i===0?'disabled':'')+' title="Move Up">‚Üë</button><button onclick="moveProxy('+i+',1)" style="background:#e3f2fd;border:none;border-radius:4px;padding:6px 10px;cursor:pointer" '+(i===proxies.length-1?'disabled':'')+' title="Move Down">‚Üì</button></td><td style="padding:12px;text-align:center"><button onclick="deleteProxy('+i+')" style="background:#ef5350;color:white;border:none;border-radius:6px;padding:6px 12px;cursor:pointer" title="Delete">üóëÔ∏è</button></td></tr>';}).join('');});}function escapeAttr(s){return s.replace(/"/g,'&quot;');}function updateProxyName(idx,name){fetch('/api/update-proxy-name',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({index:idx,name:name})}).then(r=>r.json()).then(d=>{if(d.ok){showToast('Proxy renamed to '+name,'success');}else{showToast('Failed to rename','error');}});}function moveProxy(idx,dir){const newOrder=allProxies.map((_,i)=>i);const targetIdx=idx+dir;if(targetIdx<0||targetIdx>=allProxies.length)return;[newOrder[idx],newOrder[targetIdx]]=[newOrder[targetIdx],newOrder[idx]];fetch('/api/reorder-proxies',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({order:newOrder})}).then(r=>r.json()).then(d=>{if(d.ok){showToast('Proxies reordered','success');loadProxies();}else{showToast('Failed to reorder','error');}});}loadProxies();function addProxy(){const proxy=document.getElementById('newProxyString').value.trim();if(!proxy){showToast('Please enter a proxy string','error');return;}fetch('/api/add-proxy',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({proxy_string:proxy})}).then(r=>{if(!r.ok)return r.text().then(t=>{throw new Error(t);});return r.json();}).then(d=>{if(d.ok){showToast(d.added?'Proxy added':'Proxy already exists',d.added?'success':'');document.getElementById('newProxyString').value='';loadProxies();}}).catch(e=>showToast(e.message||'Failed to add proxy','error'));}function deleteProxy(idx){if(!confirm('Delete this proxy? Make sure no devices are using it.')){return;}fetch('/api/delete-proxy',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({proxy_index:idx})}).then(r=>{if(!r.ok)return r.text().then(t=>{throw new Error(t);});return r.json();}).then(d=>{if(d.ok){showToast('Proxy deleted','success');loadProxies();}}).catch(e=>showToast(e.message||'Failed to delete proxy','error'));}function bulkImportProxies(){const proxies=document.getElementById('bulkProxies').value.trim();if(!proxies){showToast('Please paste proxy strings','error');return;}document.getElementById('bulkImportResult').textContent='Importing...';fetch('/api/bulk-import-proxies',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({proxies:proxies})}).then(r=>r.json()).then(d=>{if(d.success){const msg='Added '+d.added+' proxies'+(d.skipped>0?', skipped '+d.skipped:'');document.getElementById('bulkImportResult').innerHTML='<span style="color:#4caf50">‚úì '+msg+'</span>';showToast(msg,'success');document.getElementById('bulkProxies').value='';loadProxies();}else{document.getElementById('bulkImportResult').innerHTML='<span style="color:#c62828">‚úó Import failed</span>';showToast('Import failed','error');}}).catch(e=>{document.getElementById('bulkImportResult').innerHTML='<span style="color:#c62828">‚úó Error</span>';showToast('Import error','error');});}function loadSupervisors(){fetch('/api/supervisors').then(r=>r.json()).then(data=>{document.getElementById('adminPassword').value=data.admin_password||'';const list=document.getElementById('supervisorsList');if(!data.supervisors||!data.supervisors.length){list.innerHTML='<p style="color:#666">No supervisors configured.</p>';return;}list.innerHTML=data.supervisors.map(s=>'<div style="display:inline-flex;align-items:center;gap:8px;background:#e8f5e9;color:#2e7d32;padding:8px 15px;border-radius:20px;margin:5px;font-weight:500">'+s.name+' <button onclick="editSupervisor(\''+s.name+'\',\''+s.password+'\')" style="background:#1976d2;color:white;border:none;border-radius:50%;width:20px;height:20px;cursor:pointer;font-size:12px" title="Edit">‚úé</button> <button onclick="deleteSupervisor(\''+s.name+'\')" style="background:#ef5350;color:white;border:none;border-radius:50%;width:20px;height:20px;cursor:pointer;font-size:14px;line-height:1" title="Delete">&times;</button></div>').join('');});}loadSupervisors();function togglePasswordVisibility(id){const input=document.getElementById(id);input.type=input.type==='password'?'text':'password';}function updateAdminPassword(){const pw=document.getElementById('adminPassword').value.trim();if(!pw){showToast('Please enter a password','error');return;}fetch('/api/admin-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password:pw})}).then(r=>r.json()).then(d=>{if(d.ok){showToast('Admin password updated','success');}else{showToast('Failed to update','error');}});}function addSupervisor(){const name=document.getElementById('newSupervisorName').value.trim();const pw=document.getElementById('newSupervisorPassword').value.trim();if(!name||!pw){showToast('Name and password required','error');return;}fetch('/api/add-supervisor',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name:name,password:pw})}).then(r=>r.json()).then(d=>{if(d.ok){showToast('Supervisor added','success');document.getElementById('newSupervisorName').value='';document.getElementById('newSupervisorPassword').value='';loadSupervisors();}else{showToast(d.message||'Failed to add','error');}});}function editSupervisor(name,pw){const newName=prompt('Supervisor name:',name);if(!newName)return;const newPw=prompt('Password:',pw);if(!newPw)return;fetch('/api/update-supervisor',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({old_name:name,name:newName,password:newPw})}).then(r=>r.json()).then(d=>{if(d.ok){showToast('Supervisor updated','success');loadSupervisors();}else{showToast(d.message||'Failed to update','error');}});}function deleteSupervisor(name){if(!confirm('Delete supervisor "'+name+'"?'))return;fetch('/api/delete-supervisor',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name:name})}).then(r=>r.json()).then(d=>{if(d.ok){showToast('Supervisor deleted','success');loadSupervisors();}else{showToast(d.message||'Failed to delete','error');}});}function loadSessionSettings(){fetch('/api/session-settings').then(r=>r.json()).then(d=>{document.getElementById('sessionTimeout').value=d.session_timeout_hours||2;});}loadSessionSettings();function saveSessionSettings(){const timeout=parseInt(document.getElementById('sessionTimeout').value)||2;fetch('/api/session-settings',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({session_timeout_hours:timeout})}).then(r=>r.json()).then(d=>{if(d.ok){showToast('Session settings saved','success');loadSessionSettings();}else{showToast('Failed to save settings','error');}});}</script></body></html>