<!DOCTYPE html><html><head><title>Lumier Dynamics - Health Dashboard</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>` + baseStyles + `.diag-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:20px}.diag-card{background:#1a1a1a;border-radius:12px;padding:20px;border:1px solid #2a2a2a;border-left:4px solid #ccc}.diag-card.healthy{border-left-color:#4caf50}.diag-card.degraded{border-left-color:#ff9800}.diag-card.broken{border-left-color:#f44336}.diag-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.diag-name{font-size:1.1em;font-weight:bold;color:#e0e0e0}.diag-badge{padding:4px 10px;border-radius:15px;font-size:0.75em;font-weight:600;text-transform:uppercase}.diag-badge.healthy{background:#e8f5e9;color:#2e7d32}.diag-badge.degraded{background:#fff3e0;color:#e65100}.diag-badge.broken{background:#ffebee;color:#c62828}.diag-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:10px}.diag-stat{padding:8px;background:#121212;border-radius:6px;text-align:center}.diag-stat-value{font-size:1.1em;font-weight:bold;color:#4a9eff}.diag-stat-label{font-size:0.7em;color:#888;text-transform:uppercase}.diag-issue{padding:10px;background:#fff3e0;border-radius:8px;font-size:0.85em;color:#e65100;margin-top:10px}.diag-issue.broken{background:#ffebee;color:#c62828}.device-table{width:100%;border-collapse:collapse}.device-table th,.device-table td{padding:12px;text-align:left;border-bottom:1px solid #2a2a2a}.device-table th{background:#1e1e1e;font-weight:600;color:#888;font-size:0.85em;text-transform:uppercase}.device-table tr:hover{background:#1e2a3a}.usage-bar{height:20px;background:#2a2a2a;border-radius:10px;overflow:hidden;position:relative}.usage-bar-fill{height:100%;border-radius:10px;transition:width 0.3s}.usage-bar-label{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-size:0.75em;font-weight:600;color:#e0e0e0}.tabs{display:flex;gap:5px;margin-bottom:20px;border-bottom:1px solid #2a2a2a;padding-bottom:0}.tab{padding:12px 24px;background:transparent;border:none;border-bottom:3px solid transparent;cursor:pointer;font-weight:600;color:#888;transition:all 0.2s}.tab:hover{color:#e0e0e0}.tab.active{color:#4a9eff;border-bottom-color:#4a9eff}.tab-content{display:none}.tab-content.active{display:block}</style></head><body>` + navHTML + `<div class="main-content"><div class="page-header"><h1>üíö Health Dashboard</h1><p>Proxy status, device health, and IP trust scores</p></div><div class="stats-grid"><div class="stat-card"><div class="stat-value" id="totalProxies">-</div><div class="stat-label">Total Proxies</div></div><div class="stat-card"><div class="stat-value" id="healthyCount" style="color:#4caf50">-</div><div class="stat-label">Healthy</div></div><div class="stat-card"><div class="stat-value" id="degradedCount" style="color:#ff9800">-</div><div class="stat-label">Degraded</div></div><div class="stat-card"><div class="stat-value" id="brokenCount" style="color:#f44336">-</div><div class="stat-label">Broken</div></div><div class="stat-card"><div class="stat-value" id="successRate">-</div><div class="stat-label">Success Rate</div></div></div><div class="tabs"><button class="tab active" onclick="showTab('proxies')">üåê Proxy Status</button><button class="tab" onclick="showTab('usage')">üìä Usage Stats</button><button class="tab" onclick="showTab('devices')">üì± Device Health</button><button class="tab" onclick="showTab('trustscore')">üõ°Ô∏è IP Trust Score</button></div><div class="card"><button class="btn btn-secondary" onclick="loadDiagnostics()" style="float:right;margin-top:-10px;margin-bottom:10px">üîÑ Refresh</button><div id="proxies" class="tab-content active"><h2>Proxy Status</h2><p style="color:#666;margin-bottom:15px">Proxy health based on success rates</p><div id="diagGrid" class="diag-grid"><div class="loading">Loading...</div></div></div><div id="usage" class="tab-content"><h2>Proxy Usage Statistics</h2><p style="color:#666;margin-bottom:15px">Request distribution across all proxies</p><div id="usageStats"><div class="loading">Loading...</div></div></div><div id="devices" class="tab-content"><h2>Device Health Summary</h2><p style="color:#666;margin-bottom:15px">Top devices by activity with error rates</p><div id="deviceHealth"><div class="loading">Loading...</div></div></div><div id="trustscore" class="tab-content"><h2>IP Trust Score</h2><p style="color:#666;margin-bottom:15px">Check proxy IP reputation. Scamalytics for fraud scores, IP-API for proxy/VPN detection. Lower scores = more trustworthy.</p><div style="margin-bottom:20px"><button class="btn btn-primary" id="checkTrustBtn" onclick="checkTrustScore()">üîç Check All Proxy IPs</button><span id="trustStatus" style="margin-left:15px;color:#666"></span></div><div id="trustSummary" style="display:none;margin-bottom:20px"><div style="display:grid;grid-template-columns:1fr 1fr;gap:20px"><div style="background:#121212;padding:15px;border-radius:10px"><h4 style="margin:0 0 10px;color:#4a9eff">üìä Scamalytics</h4><div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;text-align:center"><div><div style="font-size:1.3em;font-weight:bold;color:#4a9eff" id="scamAvg">-</div><div style="font-size:0.75em;color:#888">Avg Score</div></div><div><div style="font-size:1.3em;font-weight:bold;color:#4caf50" id="scamLow">-</div><div style="font-size:0.75em;color:#888">Low Risk</div></div><div><div style="font-size:1.3em;font-weight:bold;color:#ff9800" id="scamMed">-</div><div style="font-size:0.75em;color:#888">Medium</div></div><div><div style="font-size:1.3em;font-weight:bold;color:#f44336" id="scamHigh">-</div><div style="font-size:0.75em;color:#888">High Risk</div></div></div></div><div style="background:#121212;padding:15px;border-radius:10px"><h4 style="margin:0 0 10px;color:#9c27b0">üìä IP-API (Proxy Check)</h4><div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;text-align:center"><div><div style="font-size:1.3em;font-weight:bold;color:#9c27b0" id="ipqsAvg">-</div><div style="font-size:0.75em;color:#888">Avg Score</div></div><div><div style="font-size:1.3em;font-weight:bold;color:#4caf50" id="ipqsLow">-</div><div style="font-size:0.75em;color:#888">Low Risk</div></div><div><div style="font-size:1.3em;font-weight:bold;color:#ff9800" id="ipqsMed">-</div><div style="font-size:0.75em;color:#888">Medium</div></div><div><div style="font-size:1.3em;font-weight:bold;color:#f44336" id="ipqsHigh">-</div><div style="font-size:0.75em;color:#888">High Risk</div></div></div></div></div><div style="text-align:center;margin-top:10px;font-size:0.9em;color:#666"><span id="trustTotal">0</span> proxies checked</div></div><div id="trustResults"><div style="padding:30px;text-align:center;color:#888">Click the button above to check trust scores for all proxy IPs.</div></div></div></div></div><script>` + baseJS + `document.getElementById('nav-diagnostics').classList.add('active');function checkTrustScore(){const btn=document.getElementById('checkTrustBtn');const status=document.getElementById('trustStatus');btn.disabled=true;btn.textContent='Checking...';status.textContent='Fetching scores from Scamalytics and IP-API...';fetch('/api/check-blacklist').then(r=>r.json()).then(data=>{btn.disabled=false;btn.textContent='üîç Check All Proxy IPs';status.textContent='Last checked: '+new Date().toLocaleTimeString();document.getElementById('trustSummary').style.display='block';document.getElementById('trustTotal').textContent=data.total_checked;const scam=data.scamalytics||{};const ipqs=data.ipqualityscore||{};document.getElementById('scamAvg').textContent=scam.average_score>=0?scam.average_score:'-';document.getElementById('scamLow').textContent=scam.low_risk_count||0;document.getElementById('scamMed').textContent=scam.medium_risk_count||0;document.getElementById('scamHigh').textContent=scam.high_risk_count||0;document.getElementById('ipqsAvg').textContent=ipqs.average_score>=0?ipqs.average_score:'-';document.getElementById('ipqsLow').textContent=ipqs.low_risk_count||0;document.getElementById('ipqsMed').textContent=ipqs.medium_risk_count||0;document.getElementById('ipqsHigh').textContent=ipqs.high_risk_count||0;if(!data.results||!data.results.length){document.getElementById('trustResults').innerHTML='<div style="padding:30px;text-align:center;color:#888">No proxy IPs to check.</div>';return;}function getScoreDisplay(src){if(!src||!src.available)return{score:'-',color:'#666',badge:'background:#1e1e1e;color:#666',risk:'N/A',error:src?src.error:''};const score=src.score;const risk=src.risk||'unknown';const color=risk==='low'?'#4caf50':risk==='medium'?'#ff9800':risk==='high'||risk==='very high'?'#c62828':'#666';const badge=risk==='low'?'background:#e8f5e9;color:#2e7d32':risk==='medium'?'background:#fff3e0;color:#e65100':risk==='high'||risk==='very high'?'background:#ffebee;color:#c62828':'background:#1e1e1e;color:#666';return{score:score,color:color,badge:badge,risk:risk.toUpperCase(),error:''};}document.getElementById('trustResults').innerHTML='<table class="device-table"><thead><tr><th>Proxy</th><th>IP Address</th><th style="text-align:center">Scamalytics</th><th style="text-align:center">IP-API</th></tr></thead><tbody>'+data.results.map(r=>{const s=getScoreDisplay(r.scamalytics);const i=getScoreDisplay(r.ipqualityscore);return'<tr><td><strong>'+r.name+'</strong></td><td style="font-family:monospace">'+r.ip_address+'</td><td style="text-align:center"><div style="font-weight:bold;font-size:1.3em;color:'+s.color+'">'+s.score+'</div><span style="padding:2px 8px;border-radius:10px;font-size:0.75em;font-weight:600;'+s.badge+'">'+s.risk+'</span>'+(r.scamalytics&&r.scamalytics.error?' <div style="color:#999;font-size:0.7em;margin-top:3px">'+r.scamalytics.error+'</div>':'')+'</td><td style="text-align:center"><div style="font-weight:bold;font-size:1.3em;color:'+i.color+'">'+i.score+'</div><span style="padding:2px 8px;border-radius:10px;font-size:0.75em;font-weight:600;'+i.badge+'">'+i.risk+'</span>'+(r.ipqualityscore&&r.ipqualityscore.error?' <div style="color:#999;font-size:0.7em;margin-top:3px">'+r.ipqualityscore.error+'</div>':'')+'</td></tr>';}).join('')+'</tbody></table><p style="margin-top:15px;color:#888;font-size:0.85em">Scores: 0-25 Low Risk | 26-50 Medium | 51-75 High | 76-100 Very High (lower is better)</p>';}).catch(e=>{btn.disabled=false;btn.textContent='üîç Check All Proxy IPs';status.textContent='Error: '+e.message;});}function showTab(id){document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));document.getElementById(id).classList.add('active');event.target.classList.add('active');}function loadDiagnostics(){fetch('/api/diagnostics').then(r=>r.json()).then(data=>{const s=data.summary;document.getElementById('totalProxies').textContent=s.total_proxies;document.getElementById('healthyCount').textContent=s.healthy_proxies;document.getElementById('degradedCount').textContent=s.degraded_proxies;document.getElementById('brokenCount').textContent=s.broken_proxies;document.getElementById('successRate').textContent=s.overall_success_rate.toFixed(1)+'%';const diagGrid=document.getElementById('diagGrid');if(!data.proxies.length){diagGrid.innerHTML='<div class="loading">No proxy data available yet.</div>';return;}diagGrid.innerHTML=data.proxies.map(p=>{const issueClass=p.issue_type==='none'?'healthy':p.issue_type;const badgeText=p.issue_type==='none'?'Healthy':p.issue_type.charAt(0).toUpperCase()+p.issue_type.slice(1);return'<div class="diag-card '+issueClass+'"><div class="diag-header"><span class="diag-name">'+(p.name||'Proxy #'+(p.index+1))+'</span><span class="diag-badge '+issueClass+'">'+badgeText+'</span></div><div style="color:#888;font-size:0.85em;margin-bottom:10px">'+p.ip_address+'</div><div class="diag-stats"><div class="diag-stat"><div class="diag-stat-value">'+formatNumber(p.total_requests)+'</div><div class="diag-stat-label">Requests</div></div><div class="diag-stat"><div class="diag-stat-value">'+p.success_rate.toFixed(1)+'%</div><div class="diag-stat-label">Success</div></div><div class="diag-stat"><div class="diag-stat-value">'+(p.device_count||0)+'</div><div class="diag-stat-label">Registered</div></div></div>'+(p.issue_details?'<div class="diag-issue '+(p.issue_type==='broken'?'broken':'')+'">'+p.issue_details+'</div>':'')+'</div>';}).join('');const maxReqs=Math.max(...data.proxies.map(p=>p.total_requests));document.getElementById('usageStats').innerHTML='<table class="device-table"><thead><tr><th>Proxy</th><th>Requests</th><th>Usage</th><th>Data In</th><th>Data Out</th></tr></thead><tbody>'+data.proxies.map(p=>{const pct=maxReqs>0?(p.total_requests/maxReqs*100):0;const color=pct>66?'#4caf50':pct>33?'#ff9800':'#f44336';return'<tr><td><strong>'+(p.name||'Proxy #'+(p.index+1))+'</strong><br><span style="color:#888;font-size:0.85em">'+p.ip_address+'</span></td><td>'+formatNumber(p.total_requests)+'</td><td style="width:200px"><div class="usage-bar"><div class="usage-bar-fill" style="width:'+pct+'%;background:'+color+'"></div><div class="usage-bar-label">'+pct.toFixed(0)+'%</div></div></td><td>'+formatBytes(p.bytes_in)+'</td><td>'+formatBytes(p.bytes_out)+'</td></tr>';}).join('')+'</tbody></table>';const devices=data.devices.slice(0,20);document.getElementById('deviceHealth').innerHTML=devices.length?'<table class="device-table"><thead><tr><th>Device</th><th>Proxy</th><th>Requests</th><th>Errors</th><th>Error Rate</th><th>Data</th><th>Status</th></tr></thead><tbody>'+devices.map(d=>{const name=d.name||d.username||d.ip;const errColor=d.error_rate>5?'#c62828':d.error_rate>1?'#e65100':'#666';return'<tr><td><strong>'+name+'</strong><br><span style="color:#888;font-size:0.85em">'+d.ip+'</span></td><td>'+(d.proxy_name||'-')+'</td><td>'+formatNumber(d.request_count)+'</td><td style="color:'+errColor+'">'+formatNumber(d.error_count)+'</td><td style="color:'+errColor+'">'+d.error_rate.toFixed(2)+'%</td><td>‚Üì'+formatBytes(d.bytes_in)+' ‚Üë'+formatBytes(d.bytes_out)+'</td><td><span style="color:'+(d.is_active?'#4caf50':'#999')+'">'+(d.is_active?'‚óè Active':'‚óã Inactive')+'</span></td></tr>';}).join('')+'</tbody></table>':'<div class="loading">No device data available.</div>';});}loadDiagnostics();setInterval(loadDiagnostics,30000);</script></body></html>