<!DOCTYPE html><html><head><title>Lumier Dynamics - Activity Log</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>` + baseStyles + `.activity-container{background:#1a1a1a;border-radius:12px;border:1px solid #2a2a2a;overflow:hidden}.activity-header{background:#252525;color:white;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}.activity-header h2{margin:0;font-size:1.1em}.filters{display:flex;gap:10px;flex-wrap:wrap;align-items:center}.filters select,.filters input{padding:8px 12px;border:1px solid #2a2a2a;border-radius:6px;font-size:0.9em;background:#121212;color:#e0e0e0}.activity-content{height:600px;overflow-y:auto;font-family:'Monaco','Menlo','Ubuntu Mono',monospace;font-size:0.85em}.log-entry{padding:10px 20px;border-bottom:1px solid #2a2a2a;display:grid;grid-template-columns:140px 80px 120px 120px 1fr;gap:15px;align-items:center}.log-entry:nth-child(odd){background:#1e1e1e}.log-entry:hover{background:#252525}.log-time{color:#888;white-space:nowrap;font-size:0.9em}.log-level{font-weight:600;text-transform:uppercase;font-size:0.75em;padding:3px 8px;border-radius:4px;text-align:center}.log-level.info{background:#1a2a3a;color:#4a9eff}.log-level.error{background:#3d1a1a;color:#f44336}.log-level.warn,.log-level.warning{background:#3d2a1a;color:#ff9800}.log-category{font-size:0.8em;color:#888;background:#121212;padding:3px 8px;border-radius:4px;text-align:center}.log-device{font-size:0.85em;color:#4a9eff;font-weight:500}.log-msg{color:#e0e0e0;word-break:break-word}.auto-refresh{display:flex;align-items:center;gap:8px;font-size:0.9em;color:white}.auto-refresh input{width:18px;height:18px;cursor:pointer}</style></head><body>` + navHTML + `<div class="main-content"><div class="page-header"><h1>ðŸ“‹ Activity Log</h1><p>Detailed device and system activity log with filtering</p></div><div class="stats-grid"><div class="stat-card" onclick="filterLevel('')" style="cursor:pointer"><div class="stat-value" id="totalLogs">-</div><div class="stat-label">Total Logs</div></div><div class="stat-card" onclick="filterLevel('info')" style="cursor:pointer"><div class="stat-value" id="infoLogs" style="color:#1976d2">-</div><div class="stat-label">Info</div></div><div class="stat-card" onclick="filterLevel('warn')" style="cursor:pointer"><div class="stat-value" id="warnLogs" style="color:#e65100">-</div><div class="stat-label">Warnings</div></div><div class="stat-card" onclick="filterLevel('error')" style="cursor:pointer"><div class="stat-value" id="errorLogs" style="color:#c62828">-</div><div class="stat-label">Errors</div></div></div><div class="activity-container"><div class="activity-header"><h2>ðŸ“‹ Live Activity Feed</h2><div class="filters"><select id="filterCategory" onchange="loadActivity()"><option value="">All Categories</option><option value="connection">Connection</option><option value="session">Session</option><option value="config">Config</option><option value="proxy">Proxy</option><option value="auth">Auth</option><option value="error">Error</option></select><select id="filterLevelSelect" onchange="loadActivity()"><option value="">All Levels</option><option value="info">Info</option><option value="warn">Warning</option><option value="error">Error</option></select><input type="text" id="filterDevice" placeholder="Filter by device/user..." style="width:180px" onkeyup="debounceLoad()"><button class="btn btn-secondary" onclick="loadActivity()" style="padding:8px 15px;font-size:0.85em">ðŸ”„ Refresh</button></div><label class="auto-refresh" style="margin-right:10px"><input type="checkbox" id="registeredOnly" onchange="loadActivity()"> Registered only</label><label class="auto-refresh"><input type="checkbox" id="autoRefresh" checked> Auto-refresh</label></div><div class="activity-content" id="activityContent"><div class="loading">Loading activity log...</div></div></div></div><script>` + baseJS + `document.getElementById('nav-activity').classList.add('active');let debounceTimer;function debounceLoad(){clearTimeout(debounceTimer);debounceTimer=setTimeout(loadActivity,300);}function filterLevel(level){document.getElementById('filterLevelSelect').value=level;loadActivity();}function loadActivity(){const category=document.getElementById('filterCategory').value;const level=document.getElementById('filterLevelSelect').value;const device=document.getElementById('filterDevice').value.trim();const registeredOnly=document.getElementById('registeredOnly').checked;let url='/api/activity-log?limit=500';if(category)url+='&category='+encodeURIComponent(category);if(level)url+='&level='+encodeURIComponent(level);if(device)url+='&device='+encodeURIComponent(device);if(registeredOnly)url+='&registered_only=true';fetch(url).then(r=>r.json()).then(data=>{document.getElementById('totalLogs').textContent=data.total_count||0;document.getElementById('infoLogs').textContent=data.info_count||0;document.getElementById('warnLogs').textContent=data.warn_count||0;document.getElementById('errorLogs').textContent=data.error_count||0;const container=document.getElementById('activityContent');if(!data.logs||!data.logs.length){container.innerHTML='<div style="padding:40px;text-align:center;color:#666">No activity logs yet. Device activity will appear here.</div>';return;}container.innerHTML=data.logs.slice().reverse().map(log=>{const time=new Date(log.timestamp).toLocaleString();const deviceInfo=log.username||log.device_name||log.device_ip||'-';const category=log.category||'-';return'<div class="log-entry"><span class="log-time">'+time+'</span><span class="log-level '+log.level+'">'+log.level+'</span><span class="log-category">'+category+'</span><span class="log-device" title="'+(log.device_ip||'')+'">'+deviceInfo+'</span><span class="log-msg">'+escapeHtml(log.message)+'</span></div>';}).join('');if(document.getElementById('autoRefresh').checked){container.scrollTop=0;}});}function escapeHtml(t){if(!t)return'';const d=document.createElement('div');d.textContent=t;return d.innerHTML;}loadActivity();setInterval(()=>{if(document.getElementById('autoRefresh').checked)loadActivity();},5000);</script></body></html>