<!DOCTYPE html><html><head><title>Lumier Dynamics - Analytics</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>` + baseStyles + `.chart-container{background:#1a1a1a;border-radius:12px;padding:25px;border:1px solid #2a2a2a;margin-bottom:20px;overflow:visible}.chart-container h2{margin-bottom:20px}.chart{width:100%;position:relative}.chart-bars{display:flex;align-items:flex-end;height:200px;gap:2px;padding:0 10px;border-bottom:2px solid #e0e0e0}.chart-bar{flex:1;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:4px 4px 0 0;min-width:2px;max-width:40px;position:relative;transition:height 0.3s}.chart-bar:hover{opacity:0.8}.chart-bar .tooltip{position:absolute;bottom:100%;left:50%;transform:translateX(-50%);background:#333;color:white;padding:5px 10px;border-radius:4px;font-size:0.8em;white-space:nowrap;opacity:0;transition:opacity 0.2s;pointer-events:none;z-index:10}.chart-bar:hover .tooltip{opacity:1}.chart-labels{display:flex;padding:15px 10px 5px;justify-content:space-between}.chart-label{font-size:0.85em;color:#888;font-weight:500}.time-range{text-align:center;color:#888;font-size:0.9em;margin-top:5px}</style></head><body>` + navHTML + `<div class="main-content"><div class="page-header"><h1>ðŸ“Š Traffic Analytics</h1><p>Historical traffic data and trends</p></div><div class="stats-grid"><div class="stat-card"><div class="stat-value" id="totalData">-</div><div class="stat-label">Total Data</div></div><div class="stat-card"><div class="stat-value" id="totalReqs">-</div><div class="stat-label">Total Requests</div></div><div class="stat-card"><div class="stat-value" id="peakDevices">-</div><div class="stat-label">Peak Devices</div></div><div class="stat-card"><div class="stat-value" id="errorRate">-</div><div class="stat-label">Error Rate</div></div></div><div class="chart-container"><h2>ðŸ“ˆ Traffic Over Time</h2><button class="btn btn-secondary" onclick="loadAnalytics()" style="float:right;margin-top:-45px">ðŸ”„ Refresh</button><div class="chart"><div class="chart-bars" id="trafficBars"></div><div class="chart-labels" id="trafficLabels"></div><div class="time-range" id="trafficRange"></div></div></div><div class="chart-container"><h2>ðŸ“Š Active Devices Over Time</h2><div class="chart"><div class="chart-bars" id="deviceBars"></div><div class="chart-labels" id="deviceLabels"></div><div class="time-range" id="deviceRange"></div></div></div></div><script>` + baseJS + `document.getElementById('nav-analytics').classList.add('active');function formatDateTime(d){const date=new Date(d);const day=date.getDate();const month=date.toLocaleString('default',{month:'short'});const time=date.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});return month+' '+day+', '+time;}function loadAnalytics(){fetch('/api/traffic-history').then(r=>r.json()).then(data=>{if(!data||!data.length){document.getElementById('trafficBars').innerHTML='<div class="loading">No data yet. Traffic data is collected every 5 minutes.</div>';return;}const totalBytes=data.reduce((a,d)=>a+(d.total_bytes_in||0)+(d.total_bytes_out||0),0);const totalReqs=data.length>0?data[data.length-1].total_requests:0;const peakDevices=Math.max(...data.map(d=>d.active_devices||0));const totalErrors=data.length>0?data[data.length-1].error_count:0;const errorRate=totalReqs>0?((totalErrors/totalReqs)*100).toFixed(2)+'%':'0%';document.getElementById('totalData').textContent=formatBytes(totalBytes);document.getElementById('totalReqs').textContent=formatNumber(totalReqs);document.getElementById('peakDevices').textContent=peakDevices;document.getElementById('errorRate').textContent=errorRate;const maxBytes=Math.max(...data.map(d=>(d.total_bytes_in||0)+(d.total_bytes_out||0)));const maxDevices=Math.max(...data.map(d=>d.active_devices||0));document.getElementById('trafficBars').innerHTML=data.map(d=>{const bytes=(d.total_bytes_in||0)+(d.total_bytes_out||0);const h=maxBytes>0?(bytes/maxBytes*180):5;return'<div class="chart-bar" style="height:'+h+'px"><span class="tooltip">'+formatDateTime(d.timestamp)+'<br>'+formatBytes(bytes)+'</span></div>';}).join('');const first=new Date(data[0].timestamp);const last=new Date(data[data.length-1].timestamp);document.getElementById('trafficLabels').innerHTML='<span class="chart-label">'+formatDateTime(first)+'</span><span class="chart-label">'+formatDateTime(last)+'</span>';document.getElementById('trafficRange').textContent='Showing '+data.length+' data points over '+(Math.round((last-first)/(1000*60*60)))+' hours';document.getElementById('deviceBars').innerHTML=data.map(d=>{const h=maxDevices>0?(d.active_devices/maxDevices*180):5;return'<div class="chart-bar" style="height:'+h+'px;background:linear-gradient(135deg,#4caf50 0%,#2e7d32 100%)"><span class="tooltip">'+formatDateTime(d.timestamp)+'<br>'+d.active_devices+' devices</span></div>';}).join('');document.getElementById('deviceLabels').innerHTML='<span class="chart-label">'+formatDateTime(first)+'</span><span class="chart-label">'+formatDateTime(last)+'</span>';document.getElementById('deviceRange').textContent='Peak: '+peakDevices+' devices';});}loadAnalytics();setInterval(loadAnalytics,60000);</script></body></html>