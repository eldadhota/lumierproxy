<!DOCTYPE html><html><head><title>Lumier Dynamics - Network Monitor</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>` + baseStyles + `.monitor-container{display:grid;grid-template-columns:1fr 400px;gap:20px}@media(max-width:1000px){.monitor-container{grid-template-columns:1fr}}.monitor-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;margin-bottom:25px}.monitor-stat{background:#1a1a1a;padding:15px;border-radius:12px;border:1px solid #2a2a2a;text-align:center}.monitor-stat .value{font-size:1.8em;font-weight:bold}.monitor-stat .label{color:#666;font-size:0.8em;text-transform:uppercase;margin-top:5px}.devices-section{background:#1a1a1a;border-radius:12px;border:1px solid #2a2a2a;overflow:hidden}.devices-header{background:#667eea;color:white;padding:15px 20px;display:flex;justify-content:space-between;align-items:center}.devices-header h2{margin:0;font-size:1.1em}.device-list{max-height:calc(100vh - 400px);overflow-y:auto}.device-card{padding:12px 15px;border-bottom:1px solid #2a2a2a;display:grid;grid-template-columns:auto 1fr auto;gap:12px;align-items:center;cursor:pointer;transition:all 0.2s}.device-card:hover{background:#252525}.device-card.selected{background:#1e3a5f;border-left:4px solid #4a9eff}.device-card.active .status-dot{background:#4caf50}.device-card.inactive .status-dot{background:#666}.device-info{min-width:0}.device-name{font-weight:600;color:#e0e0e0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.device-ip{font-size:0.8em;color:#888;font-family:monospace}.status-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}.device-meta{text-align:right;font-size:0.8em;color:#888}.detail-panel{background:#1a1a1a;border-radius:12px;border:1px solid #2a2a2a;overflow:hidden;position:sticky;top:20px}.detail-header{background:#333;color:white;padding:15px 20px}.detail-header h3{margin:0;font-size:1.1em}.detail-body{padding:0}.detail-section{padding:15px 20px;border-bottom:1px solid #2a2a2a}.detail-section h4{margin:0 0 12px;color:#4a9eff;font-size:0.9em;text-transform:uppercase}.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}.detail-item{background:#121212;padding:10px;border-radius:8px}.detail-label{font-size:0.75em;color:#888;text-transform:uppercase}.detail-value{font-weight:600;color:#e0e0e0;margin-top:3px;word-break:break-all}.detail-value.mono{font-family:monospace;font-size:0.9em}.status-badge{display:inline-block;padding:4px 10px;border-radius:12px;font-size:0.8em;font-weight:600}.status-badge.online{background:#1a3d1a;color:#4caf50}.status-badge.offline{background:#2a2a2a;color:#888}.log-section{max-height:300px;overflow-y:auto}.log-entry{padding:8px 15px;border-bottom:1px solid #2a2a2a;font-size:0.85em;display:grid;grid-template-columns:70px 1fr auto;gap:10px;align-items:center}.log-entry:hover{background:#252525}.log-time{color:#888;font-family:monospace;font-size:0.8em}.log-host{color:#e0e0e0;font-family:monospace;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.log-data{color:#4a9eff;font-size:0.8em}.empty-detail{padding:40px 20px;text-align:center;color:#666}.connections-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center}.connections-modal.show{display:flex}.modal-content{background:#1a1a1a;border-radius:12px;width:90%;max-width:800px;max-height:85vh;overflow:hidden}.modal-header{background:#333;color:white;padding:15px 20px;display:flex;justify-content:space-between;align-items:center}.modal-header h3{margin:0}.modal-close{background:none;border:none;color:white;font-size:1.5em;cursor:pointer;padding:0 10px}.modal-body{padding:0;max-height:70vh;overflow-y:auto}.conn-table{width:100%;border-collapse:collapse}.conn-table th,.conn-table td{padding:10px 15px;text-align:left;border-bottom:1px solid #2a2a2a}.conn-table th{background:#1e1e1e;font-weight:600;color:#888;font-size:0.85em;position:sticky;top:0}</style></head><body>` + navHTML + `<div class="main-content"><div class="page-header"><h1>üñ•Ô∏è Device Monitor</h1><p>Real-time device activity and connection logs</p></div><div class="monitor-stats"><div class="monitor-stat"><div class="value" style="color:#4a9eff" id="totalDevices">-</div><div class="label">Total Devices</div></div><div class="monitor-stat"><div class="value" style="color:#4caf50" id="activeNow">-</div><div class="label">Active Now</div></div><div class="monitor-stat"><div class="value" style="color:#2196F3" id="totalDataIn">-</div><div class="label">Data In</div></div><div class="monitor-stat"><div class="value" style="color:#9c27b0" id="totalDataOut">-</div><div class="label">Data Out</div></div><div class="monitor-stat"><div class="value" style="color:#ff9800" id="uptimeValue">-</div><div class="label">Uptime</div></div></div><div class="monitor-container"><div class="devices-section"><div class="devices-header"><h2>üì± Devices</h2><button class="btn btn-secondary" onclick="loadOverview()" style="padding:6px 12px;font-size:0.85em">üîÑ Refresh</button></div><div id="devicesList" class="device-list"><div style="padding:40px;text-align:center;color:#666">Loading devices...</div></div></div><div class="detail-panel"><div class="detail-header"><h3 id="detailTitle">üìã Device Details</h3></div><div class="detail-body" id="detailBody"><div class="empty-detail">Select a device to view details</div></div></div></div></div><div class="connections-modal" id="connModal" onclick="if(event.target===this)closeModal()"><div class="modal-content"><div class="modal-header"><h3 id="modalTitle">Connection History</h3><button class="modal-close" onclick="closeModal()">&times;</button></div><div class="modal-body"><div id="connList">Loading...</div></div></div></div><script>` + baseJS + `document.getElementById('nav-monitoring').classList.add('active');let selectedDevice=null;let allDevices=[];function loadOverview(){fetch('/api/network-overview').then(r=>r.json()).then(data=>{document.getElementById('totalDevices').textContent=data.total_devices;document.getElementById('activeNow').textContent=data.active_count;document.getElementById('totalDataIn').textContent=formatBytes(data.total_bytes_in);document.getElementById('totalDataOut').textContent=formatBytes(data.total_bytes_out);allDevices=data.devices||[];renderDevices();if(selectedDevice){const d=allDevices.find(x=>x.ip===selectedDevice);if(d)showDeviceDetail(d);}});fetch('/api/system-stats').then(r=>r.json()).then(d=>{document.getElementById('uptimeValue').textContent=d.uptime_formatted;});}function renderDevices(){const list=document.getElementById('devicesList');if(!allDevices.length){list.innerHTML='<div style="padding:40px;text-align:center;color:#666">No devices found.</div>';return;}list.innerHTML=allDevices.map(d=>{const statusClass=d.is_active?'active':'inactive';const isSelected=selectedDevice===d.ip?'selected':'';return'<div class="device-card '+statusClass+' '+isSelected+'" onclick="selectDevice(\''+d.ip+'\')"><div class="status-dot"></div><div class="device-info"><div class="device-name">'+d.name+'</div><div class="device-ip">'+d.ip+'</div></div><div class="device-meta"><div>'+formatBytes(d.bytes_in+d.bytes_out)+'</div><div>'+(d.is_active?'Active':Math.round(d.last_seen_min||d.last_active_min||0)+'m ago')+'</div></div></div>';}).join('');}function selectDevice(ip){selectedDevice=ip;renderDevices();const d=allDevices.find(x=>x.ip===ip);if(d)showDeviceDetail(d);}function showDeviceDetail(d){document.getElementById('detailTitle').textContent='üìã '+d.name;const statusBadge=d.is_active?'<span class="status-badge online">‚óè Online</span>':'<span class="status-badge offline">‚óã Offline</span>';const lastActive=d.is_active?'Active now':(d.last_seen_min||d.last_active_min||0).toFixed(0)+' minutes ago';document.getElementById('detailBody').innerHTML='<div class="detail-section"><h4>Device Information</h4><div class="detail-grid"><div class="detail-item"><div class="detail-label">Name</div><div class="detail-value">'+d.name+'</div></div><div class="detail-item"><div class="detail-label">Status</div><div class="detail-value">'+statusBadge+'</div></div><div class="detail-item"><div class="detail-label">IP Address</div><div class="detail-value mono">'+d.ip+'</div></div><div class="detail-item"><div class="detail-label">MAC Address</div><div class="detail-value mono">'+(d.mac||'N/A')+'</div></div><div class="detail-item"><div class="detail-label">Proxy</div><div class="detail-value">'+(d.proxy_name||'Default')+'</div></div><div class="detail-item"><div class="detail-label">Group</div><div class="detail-value">'+(d.group||'Default')+'</div></div></div></div><div class="detail-section"><h4>Activity Stats</h4><div class="detail-grid"><div class="detail-item"><div class="detail-label">Last Active</div><div class="detail-value">'+lastActive+'</div></div><div class="detail-item"><div class="detail-label">Session Expiry</div><div class="detail-value">'+(d.session_expiry||'N/A')+'</div></div><div class="detail-item"><div class="detail-label">Total Requests</div><div class="detail-value">'+formatNumber(d.request_count||0)+'</div></div><div class="detail-item"><div class="detail-label">Error Count</div><div class="detail-value">'+(d.error_count||0)+'</div></div><div class="detail-item"><div class="detail-label">Data In</div><div class="detail-value">'+formatBytes(d.bytes_in||0)+'</div></div><div class="detail-item"><div class="detail-label">Data Out</div><div class="detail-value">'+formatBytes(d.bytes_out||0)+'</div></div></div></div><div class="detail-section"><h4>Recent Connections <button onclick="showFullHistory(\''+d.ip+'\',\''+d.name+'\')" style="float:right;background:#4a9eff;color:white;border:none;padding:4px 10px;border-radius:4px;cursor:pointer;font-size:0.8em">View All</button></h4><div id="recentLogs" class="log-section"><div style="padding:20px;text-align:center;color:#666">Loading...</div></div></div>';loadRecentLogs(d.ip);}function loadRecentLogs(ip){fetch('/api/device-connections?device_ip='+encodeURIComponent(ip)+'&limit=10').then(r=>r.json()).then(conns=>{const container=document.getElementById('recentLogs');if(!conns||!conns.length){container.innerHTML='<div style="padding:20px;text-align:center;color:#666">No recent connections</div>';return;}container.innerHTML=conns.slice(0,10).map(c=>{const time=new Date(c.timestamp).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit',second:'2-digit'});return'<div class="log-entry"><div class="log-time">'+time+'</div><div class="log-host">'+c.host+'</div><div class="log-data">'+formatBytes(c.bytes_in+c.bytes_out)+'</div></div>';}).join('');});}function showFullHistory(ip,name){document.getElementById('modalTitle').textContent=name+' - Connection History';document.getElementById('connList').innerHTML='<div style="text-align:center;padding:20px">Loading...</div>';document.getElementById('connModal').classList.add('show');fetch('/api/device-connections?device_ip='+encodeURIComponent(ip)+'&limit=100').then(r=>r.json()).then(conns=>{if(!conns||!conns.length){document.getElementById('connList').innerHTML='<div style="text-align:center;color:#666;padding:30px">No connections recorded.</div>';return;}document.getElementById('connList').innerHTML='<table class="conn-table"><thead><tr><th>Time</th><th>Host</th><th>Protocol</th><th>Data In</th><th>Data Out</th></tr></thead><tbody>'+conns.map(c=>{const time=new Date(c.timestamp).toLocaleString();return'<tr><td>'+time+'</td><td style="font-family:monospace;max-width:250px;overflow:hidden;text-overflow:ellipsis">'+c.host+'</td><td>'+c.protocol+'</td><td>'+formatBytes(c.bytes_in)+'</td><td>'+formatBytes(c.bytes_out)+'</td></tr>';}).join('')+'</tbody></table>';});}function showConnections(ip,name){showFullHistory(ip,name);}function closeModal(){document.getElementById('connModal').classList.remove('show');}loadOverview();setInterval(loadOverview,5000);</script></body></html>