<!DOCTYPE html><html><head><title>Lumier Dynamics - Access Point</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>` + baseStyles + `.ap-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;margin-bottom:25px}.ap-stat{background:#1a1a1a;padding:20px;border-radius:12px;border:1px solid #2a2a2a;text-align:center}.ap-stat .value{font-size:2em;font-weight:bold}.ap-stat .label{color:#666;font-size:0.85em;text-transform:uppercase;margin-top:5px}.devices-section{background:#1a1a1a;border-radius:12px;border:1px solid #2a2a2a;overflow:hidden;margin-bottom:20px}.devices-header{background:#667eea;color:white;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}.devices-header h2{margin:0;font-size:1.1em}.device-row{padding:15px 20px;border-bottom:1px solid #f0f0f0;display:grid;grid-template-columns:auto 1fr 1fr 1fr auto;gap:15px;align-items:center}.device-row:hover{background:#f8f9ff}.device-row.pending{background:#fff3e0;border-left:4px solid #ff9800}.device-row.confirmed{border-left:4px solid #4caf50}.device-row.offline{opacity:0.6}.device-status{width:12px;height:12px;border-radius:50%}.device-info{display:flex;flex-direction:column;gap:3px}.device-name{font-weight:600;color:#e0e0e0}.device-mac{font-size:0.8em;color:#888;font-family:monospace}.device-ip{font-size:0.85em;color:#666;font-family:monospace}.device-proxy{text-align:center}.proxy-badge{background:#e3f2fd;color:#1976d2;padding:5px 12px;border-radius:15px;font-size:0.85em;font-weight:500}.device-data{text-align:right;font-size:0.85em;color:#666}.device-actions{display:flex;gap:8px}.btn-approve{background:#4caf50;color:white;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-weight:500}.btn-approve:hover{background:#43a047}.btn-revoke{background:#ff9800;color:white;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}.btn-delete{background:#f44336;color:white;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}.filter-tabs{display:flex;gap:5px;flex-wrap:wrap}.filter-tab{background:rgba(255,255,255,0.2);color:white;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-weight:500}.filter-tab.active{background:#1a1a1a;color:#4a9eff}</style></head><body>` + navHTML + `<div class="main-content"><div class="page-header"><h1>üì° Access Point Devices</h1><p>Manage devices connected via the WiFi access point</p></div><div class="ap-stats"><div class="ap-stat"><div class="value" style="color:#ff9800" id="pendingCount">-</div><div class="label">Pending Approval</div></div><div class="ap-stat"><div class="value" style="color:#4caf50" id="confirmedCount">-</div><div class="label">Approved</div></div><div class="ap-stat"><div class="value" style="color:#2196F3" id="onlineCount">-</div><div class="label">Online Now</div></div><div class="ap-stat"><div class="value" style="color:#4a9eff" id="totalCount">-</div><div class="label">Total Devices</div></div></div><div class="devices-section"><div class="devices-header"><h2>Connected Devices</h2><div class="filter-tabs"><button class="filter-tab active" onclick="setFilter('all')">All</button><button class="filter-tab" onclick="setFilter('pending')">Pending</button><button class="filter-tab" onclick="setFilter('confirmed')">Approved</button><button class="filter-tab" onclick="setFilter('online')">Online</button></div><button class="btn btn-secondary" onclick="loadDevices()" style="padding:6px 12px;font-size:0.85em">üîÑ Refresh</button></div><div id="devicesList"><div style="padding:40px;text-align:center;color:#666">Loading devices...</div></div></div><div class="card"><h2>‚ÑπÔ∏è Access Point Network</h2><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-top:15px"><div style="background:#121212;padding:15px;border-radius:8px"><strong>Network:</strong> 10.10.10.0/24</div><div style="background:#121212;padding:15px;border-radius:8px"><strong>Gateway:</strong> 10.10.10.1</div><div style="background:#121212;padding:15px;border-radius:8px"><strong>DHCP Range:</strong> 10.10.10.100-200</div><div style="background:#121212;padding:15px;border-radius:8px"><strong>Proxy Port:</strong> 8888</div></div><p style="margin-top:15px;color:#666;font-size:0.9em"><strong>Security:</strong> New devices are blocked until approved. All traffic must go through the proxy.</p></div></div><script>` + baseJS + `document.getElementById('nav-ap').classList.add('active');let currentFilter='all';let allDevices=[];function setFilter(f){currentFilter=f;document.querySelectorAll('.filter-tab').forEach(t=>t.classList.remove('active'));event.target.classList.add('active');renderDevices();}function loadDevices(){fetch('/api/ap/status').then(r=>r.json()).then(s=>{document.getElementById('pendingCount').textContent=s.pending_devices;document.getElementById('confirmedCount').textContent=s.confirmed_devices;document.getElementById('onlineCount').textContent=s.online_devices;document.getElementById('totalCount').textContent=s.total_devices;});fetch('/api/ap/devices').then(r=>r.json()).then(devices=>{allDevices=devices;renderDevices();});}function renderDevices(){const list=document.getElementById('devicesList');let filtered=allDevices;if(currentFilter==='pending')filtered=allDevices.filter(d=>!d.confirmed);else if(currentFilter==='confirmed')filtered=allDevices.filter(d=>d.confirmed);else if(currentFilter==='online')filtered=allDevices.filter(d=>d.status==='online');if(!filtered.length){list.innerHTML='<div style="padding:40px;text-align:center;color:#666">No devices found.</div>';return;}list.innerHTML=filtered.map(d=>{const statusColor=d.status==='online'?'#4caf50':'#ccc';const rowClass=(d.confirmed?'confirmed':'pending')+' '+(d.status==='offline'?'offline':'');const name=d.custom_name||d.hostname||'Unknown Device';return'<div class="device-row '+rowClass+'"><div class="device-status" style="background:'+statusColor+'" title="'+d.status+'"></div><div class="device-info"><span class="device-name">'+name+'</span><span class="device-mac">'+d.mac+'</span><span class="device-ip">'+d.ip+'</span></div><div class="device-proxy"><span class="proxy-badge">'+d.proxy_name+'</span><select onchange="changeProxy(\''+d.mac+'\',this.value)" style="margin-top:8px;padding:5px;border:1px solid #ddd;border-radius:4px;font-size:0.85em" id="proxy-'+d.mac.replace(/:/g,'')+'"></select></div><div class="device-data"><div>'+formatBytes(d.bytes_in+d.bytes_out)+' total</div><div>'+formatNumber(d.request_count)+' requests</div><div style="margin-top:5px;color:#888">'+d.group+'</div></div><div class="device-actions">'+(d.confirmed?'<button class="btn-revoke" onclick="toggleConfirm(\''+d.mac+'\',false)" title="Revoke access">‚õî</button>':'<button class="btn-approve" onclick="toggleConfirm(\''+d.mac+'\',true)">‚úì Approve</button>')+'<button class="btn-delete" onclick="deleteDevice(\''+d.mac+'\')" title="Delete">üóëÔ∏è</button></div></div>';}).join('');loadProxyOptions();}function loadProxyOptions(){fetch('/api/proxies').then(r=>r.json()).then(proxies=>{allDevices.forEach(d=>{const sel=document.getElementById('proxy-'+d.mac.replace(/:/g,''));if(sel){sel.innerHTML=proxies.map((p,i)=>'<option value="'+i+'"'+(i===d.proxy_index?' selected':'')+'>'+p.custom_name+'</option>').join('');}});});}function toggleConfirm(mac,confirmed){fetch('/api/ap/device/confirm',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mac:mac,confirmed:confirmed})}).then(r=>r.json()).then(d=>{if(d.success){showToast(confirmed?'Device approved':'Access revoked','success');loadDevices();}else{showToast('Failed','error');}});}function changeProxy(mac,idx){fetch('/api/ap/device/proxy',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mac:mac,proxy_index:parseInt(idx)})}).then(r=>r.json()).then(d=>{if(d.success){showToast('Proxy changed to '+d.proxy_name,'success');loadDevices();}});}function deleteDevice(mac){if(!confirm('Delete this device? It will reappear if it reconnects.'))return;fetch('/api/ap/device/delete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mac:mac})}).then(r=>r.json()).then(d=>{if(d.success){showToast('Device deleted','success');loadDevices();}});}loadDevices();setInterval(loadDevices,10000);</script></body></html>